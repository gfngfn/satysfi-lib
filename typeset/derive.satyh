@import: ../option-ext
@import: derive/ast
@import: derive/config
@import: derive/line
@import: derive/render

module Derive : sig

    val \proven : [derive-config?; DeriveAst.t] math-cmd

end = struct

    open DeriveRender

    let-math \proven ?:config ast = render-math (config |> Option.from default-config) ast

end

module DeriveDSL : sig

    % DSL
    val derive: math -> DeriveAst.t
    val by: inline-text -> DeriveAst.t -> DeriveAst.t
    val byOp: inline-text -> DeriveAst.t -> DeriveAst.t
    val from: DeriveAst.t list -> DeriveAst.t -> DeriveAst.t
    val withLine: DeriveLine.u -> DeriveAst.t -> DeriveAst.t

    val assume: math -> DeriveAst.t

    % Lines
    val standard-line : DeriveLine.u
    val no-line       : DeriveLine.u
    val dotted-line   : length -> length -> DeriveLine.u

end = struct

    let standard-line = DeriveLine.standard-line
    let no-line = DeriveLine.no-line
    let dotted-line = DeriveLine.dotted-line

    let derive conclusion = DeriveAst.make None None conclusion [] None

    let assume assumption =
        let no-line = Option.some(DeriveLine.no-line) in
        DeriveAst.make None None assumption [] no-line

    let by label-text ast = ast |> DeriveAst.with-main-label label-text
    let byOp label-text ast = ast |> DeriveAst.with-sub-label label-text
    let from assumptions ast = ast |> DeriveAst.with-assumptions assumptions
    let withLine line ast = ast |> DeriveAst.with-line line

end